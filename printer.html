<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Imprimantă NIIMBOT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <style>
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; }
        #status { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

<div class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-lg p-6">
    <div class="text-center">
        <span class="material-symbols-outlined text-6xl text-blue-600">biotech</span>
        <h1 class="text-2xl font-bold text-gray-800 mt-2">
            Diagnosticare Imprimantă
        </h1>
        
        <p id="script-version" class="text-lg font-bold text-red-500 mt-2"></p>
        
        <p id="status" class="text-gray-500 mt-2 text-left bg-gray-100 p-3 rounded-lg font-mono text-xs">Așteptare comandă...</p>
    </div>

    <div class="mt-6">
        <button id="connect-btn" class="w-full flex items-center justify-center gap-2 rounded-lg bg-blue-600 py-3 text-base font-bold text-white shadow-md hover:bg-blue-700">
            <span class="material-symbols-outlined">bluetooth_searching</span>
            Pornește Scanarea Finală
        </button>
    </div>
    
    <div class="text-center mt-6">
         <a href="products.html" class="text-sm text-blue-600 hover:underline">Înapoi la Produse</a>
    </div>
</div>

<script>
// --- COD DE DIAGNOSTICARE FINAL (v3.1) - GĂSEȘTE CARACTERISTICILE ---

const connectBtn = document.getElementById('connect-btn');
const statusP = document.getElementById('status');
const versionElement = document.getElementById('script-version');

// Folosim UUID-ul de Serviciu pe care l-am confirmat că este corect
const CORRECT_SERVICE_UUID = '49535343-fe7d-4ae5-8fa9-9fafd205e455';

async function discoverCharacteristics() {
    try {
        statusP.textContent = "Pas 1: Verificăm suportul Bluetooth...";
        if (!navigator.bluetooth) {
            statusP.textContent = "EROARE: Acest browser nu suportă Web Bluetooth.";
            return;
        }

        statusP.textContent = "Pas 2: Se deschide meniul. Alege imprimanta...";
        
        const device = await navigator.bluetooth.requestDevice({
            filters: [{ services: [CORRECT_SERVICE_UUID] }]
        });

        statusP.textContent = `Pas 3: Dispozitiv găsit: ${device.name}. Se conectează...`;
        const server = await device.gatt.connect();
        
        statusP.textContent = "Pas 4: Conectat! Se accesează serviciul...";
        const service = await server.getPrimaryService(CORRECT_SERVICE_UUID);
        
        statusP.textContent = "Pas 5: Serviciu accesat! Se citesc TOATE caracteristicile...";

        const characteristics = await service.getCharacteristics();

        if (!characteristics || characteristics.length === 0) {
            statusP.innerHTML = "<b>EROARE:</b> Am găsit serviciul, dar nu conține nicio caracteristică.";
            server.disconnect();
            return;
        }

        let reportHTML = "<b>SUCCES! Copiază și trimite tot acest text:</b><br><br>";
        reportHTML += `<b>Serviciu: ${service.uuid}</b><br>`;
        
        for (const char of characteristics) {
            let props = [];
            if (char.properties.read) props.push('CITIRE');
            if (char.properties.write) props.push('SCRIERE');
            if (char.properties.writeWithoutResponse) props.push('SCRIERE FĂRĂ RĂSPUNS');
            if (char.properties.notify) props.push('NOTIFICARE');
            
            reportHTML += `<br><b>- Caracteristică:</b> ${char.uuid}<br>`;
            reportHTML += `  <i>Proprietăți: ${props.join(', ')}</i><br>`;
        }

        statusP.innerHTML = reportHTML;
        server.disconnect();

    } catch (error) {
        statusP.innerHTML = `<b>EROARE:</b> ${error.name} - ${error.message}`;
    }
}

connectBtn.addEventListener('click', discoverCharacteristics);

document.addEventListener('DOMContentLoaded', () => {
    if (versionElement) {
        // SETĂM VERSIUNEA AICI
        versionElement.textContent = 'v3.1';
    }
});

</script>
</body>
</html>
